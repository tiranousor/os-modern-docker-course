# Обзор команд Docker

В этой лекции мы познакомимся с основными командами Docker, научимся запускать контейнеры, управлять ими и очищать окружение от ненужных образов.

---

## 1. `docker run`

Запуск контейнера из образа:

```bash
docker run nginx
```

Если образ отсутствует локально — Docker скачает его из Docker Hub.

---

## 2. `docker ps` и `docker ps -a`

* `docker ps` — показывает **только работающие** контейнеры.
* `docker ps -a` — показывает **все** контейнеры (включая остановленные).

```bash
docker ps
docker ps -a
```

Каждый контейнер получает уникальный ID и имя. Если имя не задано — оно генерируется автоматически.

---

## 3. `docker stop`

Остановка работающего контейнера по ID или имени:

```bash
docker stop <container_id_or_name>
```

Чтобы узнать ID или имя — используйте `docker ps`. Также, чтобы не писать длинный ID контейнера, достаточно ввести первые `n` (n ~ 3-4) символов ID и не писать всю строку.


---

## 4. `docker rm`

Удаление остановленного контейнера:

```bash
docker rm <container_id_or_name>
```

Перед удалением убедитесь, что контейнер **остановлен**.

---

## 5. `docker images`

Список всех образов, загруженных локально:

```bash
docker images
```

Показывает название, тег, ID и размер каждого образа.

---

## 6. `docker rmi`

Удаление ненужного образа:

```bash
docker rmi nginx
```

> Перед удалением убедитесь, что **все контейнеры**, созданные из этого образа, остановлены и удалены.

---

## 7. `docker pull`

Загрузка образа из Docker Hub без его запуска:

```bash
docker pull nginx
```

Это может быть полезно, если вы хотите подготовиться заранее.

---

## 8. Поведение контейнера при отсутствии процесса

Если контейнер не запускает активный процесс, он завершится сразу:

```bash
docker run ubuntu
```

Контейнер сразу переходит в состояние `Exited`, потому что у него нет задачи.

Пример запуска с временным процессом:

```bash
docker run ubuntu sleep 5
```

Контейнер завершится через 5 секунд.

---

## 9. Работа с реальным приложением: анализ текста

Давайте поработаем с реальным приложением — контейнером для анализа тональности текста: [`alisakhrn/sentiment-analysis-app`](https://hub.docker.com/r/alisakhrn/sentiment-analysis-app)

Это веб-приложение с REST API на Flask, которое принимает текст и возвращает его эмоциональную окраску (позитивная, негативная или нейтральная).

### Шаг 1. Запуск приложения в фоновом режиме

```bash
docker run -d -p 5000:5000 alisakhrn/sentiment-analysis-app
```

> Приложение будет доступно на `http://localhost:5000`

### Шаг 2. Проверка работы через `curl`

Пример запроса (проверка позитивного текста):

```bash
curl -X POST -H "Content-Type: application/json" \
  -d '{"text": "I love Docker!"}' \
  http://localhost:5000/predict
```

Ожидаемый ответ:

```json
{"label": "POSITIVE"}
```

### Шаг 3. Выполнение команды в работающем контейнере (`docker exec`)

Найди ID или имя контейнера:

```bash
docker ps
```

Затем выполни команду:

```bash
docker exec <container_name_or_id> ps aux
```

Это покажет процессы, работающие внутри контейнера.

Можно также войти внутрь интерактивно:

```bash
docker exec -it <container_name_or_id> /bin/sh
```

Теперь ты можешь просматривать файлы, логи, конфигурации прямо изнутри контейнера приложения.

---

## 10. `docker attach` и `-d` (на примере анализа текста)

Рассмотрим эти команды на примере уже запущенного контейнера `alisakhrn/sentiment-analysis-app`.

### Запуск контейнера в foreground (с выводом в терминал)

```bash
docker run alisakhrn/sentiment-analysis-app
```

Вы увидите запуск Flask-приложения в консоли. Это удобно для отладки, но вы не сможете взаимодействовать с терминалом до остановки контейнера.

Чтобы остановить контейнер, нажмите `Ctrl + C` — это завершит процесс и вернёт вас в терминал.

### Запуск контейнера в detached-режиме (фоном)

```bash
docker run -d -p 5000:5000 alisakhrn/sentiment-analysis-app
```

Теперь контейнер будет работать в фоне, а терминал останется доступным.

### Прикрепление к работающему контейнеру

Если вы хотите «вживую» увидеть, что происходит в контейнере:

1. Посмотрите ID контейнера:

```bash
docker ps
```

2. Прикрепитесь к контейнеру:

```bash
docker attach <container_id_or_name>
```

Вы увидите stdout-приложения (например, логи запросов Flask).

> Для выхода из attach, **не останавливая контейнер**, нажмите `Ctrl + P`, затем `Ctrl + Q`.

Это полезно для живого мониторинга, особенно при запуске веб-сервисов.
