
# Лекция 3. Команда `docker run` и её параметры

## Зачем так важно знать `docker run`?

`docker run` — одна из самых часто используемых команд в Docker. Она позволяет не просто запустить контейнер, но и гибко управлять его окружением: пробрасывать порты, назначать имя контейнеру, запускать его в интерактивном режиме и многое другое.

Разберём пошагово основные возможности этой команды.

---

## 1. Запуск образа с указанием версии (тега)

Если тег не указан, по умолчанию используется `latest`:

```bash
docker run redis
```

Для запуска конкретной версии Redis:

```bash
docker run redis:5.0
```

Все доступные теги можно найти на Docker Hub в разделе образа.
Пример: [Redis tags](https://hub.docker.com/_/redis).

---

## 2. Интерактивный режим: `-it`

По умолчанию контейнер не слушает ввод с клавиатуры. Чтобы взаимодействовать с ним напрямую, используйте флаги `-i` (интерактивный режим) и `-t` (псевдотерминал).

```bash
docker run -it --rm python:3.12-alpine python
```

Теперь вы в интерактивной консоли Python внутри контейнера.
Попробуйте: `print(2+2)` → `exit()`.

> `--rm` удалит контейнер после выхода — удобно для одноразовых интерактивных сессий.

---

## 3. Проброс портов: `-p`

Контейнеры имеют внутренний IP, недоступный снаружи. Чтобы пользователь мог достучаться до сервиса в контейнере, пробрасываем порт.

### Диагностический HTTP-сервис **whoami**

```bash
docker run -d --name whoami -p 8081:80 traefik/whoami
```

Откройте `http://localhost:8081` — увидите информацию о запросе.

## 4. Именование контейнеров: `--name`

Чтобы не обращаться к длинному ID контейнера, можно присвоить имя:

```bash
docker run -d --name my-redis -p 6379:6379 redis:7-alpine
```
Проверим, что работает (без установки ничего на хост):

```bash
docker exec -it my-redis redis-cli PING
# ответ: PONG
```
Теперь вместо `docker stop <id>` достаточно:

```bash
docker stop my-redis
```
---

## 5. Том для хранения данных: `-v`

Контейнер — одноразовый. У контейнера есть своя временная файловая система. Когда контейнер удаляют — все файлы внутри него пропадают.

Том — это **постоянное** хранилище. Это папка вне контейнера (на хосте) или область, которая упраляется Docker-ом, куда контейнер складывает данные.
Даже если контейнер удалить и создать новый — данные в томе сохранятся.

**-v <HOST> : <CONTAINER>** — смонтировать папку хоста в контейнер.

Легко запомнить: сначала **откуда (HOST)**, потом **куда (CONTAINER)**.
Томма подключаются следующим образом:

Сайт из папки хоста (nginx читает статику с диска)

# 1) создаём папку сайта и файл index.html на хосте
mkdir site
"Запись и папка созданы" | Set-Content .\site\index.html

# 2) поднимаем nginx и монтируем папку read-only (":ro")
#    порт 8080 на хосте → порт 80 в контейнере
docker run -d --name web -p 8080:80 -v "${PWD}\site:/usr/share/nginx/html:ro" nginx:alpine

# 3) открываем в браузере
# http://localhost:8080

# 4) меняем файл — обновления видны сразу
"Обновление завершено" | Set-Content .\site\index.html

# 5) контейнер можно удалить — файлы останутся в .\site
# docker rm -f web


Зачем это нужно: том делает данные независимыми от жизни контейнера (удобно для БД, статических файлов, загрузок и тп).

---

## 6. Автоматическое удаление: `--rm`

Иногда удобно запускать контейнеры для одноразовых задач:

```bash
docker run --rm alpine echo "Hello!"
```
После выполнения команда контейнер удаляется автоматически.

---

## 7. Инспекция контейнера: `docker inspect`

Для получения полной информации о контейнере:

```bash
docker inspect my-redis
```

Вывод — JSON с данными о сети, томах, настройках и статусе.

---

## 8. Логи контейнера: `docker logs`

Все процессы в контейнере пишут в стандартный вывод. Чтобы просмотреть логи:

```bash
docker logs my-redis
```

В разработке часто используют именно `docker logs`, а не отдельные файлы.

---

## 9. Резюме по параметрам `docker run`

| Параметр       | Назначение                           |
| -------------- | ------------------------------------ |
| `-d`           | Запуск в фоне (detached mode)        |
| `-it`          | Интерактивный режим с терминалом     |
| `-p host:cont` | Проброс портов                       |
| `--name`       | Задать имя контейнеру                |
| `-v host:cont` | Проброс папки (том)                  |
| `--rm`         | Удаление контейнера после завершения |
| `image:tag`    | Запуск конкретной версии образа      |

