# CMD и ENTRYPOINT в Docker

## 1. Почему контейнер сразу останавливается?

Если выполнить:

```bash
docker run ubuntu
```

Контейнер запустится и сразу завершится.

Почему?

* В образе **Ubuntu** по умолчанию в `Dockerfile` прописано `CMD ["bash"]`.
* `bash` — это интерактивная оболочка. Она ждёт терминал.
* Так как Docker не подключает терминал автоматически, `bash` завершается → вместе с ним умирает контейнер.

В контейнере «живёт» главный процесс. Если он завершился — контейнер тоже.

---

## 2. Определение команды по умолчанию

* В `Dockerfile` можно указать команду, которая запускается при старте контейнера:

  * Для `nginx` это `nginx`.
  * Для `mysql` — `mysqld`.
  * Для Ubuntu — `bash`.

Это задаётся инструкциями **`CMD`** или **`ENTRYPOINT`**.

---

## 3. CMD: команда по умолчанию

Пример:

```dockerfile
FROM ubuntu:22.04
CMD ["sleep", "5"]
```

* При запуске контейнер будет выполняться `sleep 5`.
* Через 5 секунд процесс завершится, контейнер остановится.

Если передать новую команду:

```bash
docker run ubuntu-sleeper sleep 10
```

То она полностью заменит `CMD`. Контейнер проспит 10 секунд.

---

## 4. ENTRYPOINT: фиксированная команда

Пример:

```dockerfile
FROM ubuntu:22.04
ENTRYPOINT ["sleep"]
```

Теперь если выполнить:

```bash
docker run ubuntu-sleeper 10
```

Docker соберёт команду: `sleep 10`.

Отличие: аргументы из командной строки **добавляются** к ENTRYPOINT, а не заменяют его.

---

## 5. Совместное использование CMD + ENTRYPOINT

Можно указать ENTRYPOINT как фиксированную команду, а CMD — как значение по умолчанию:

```dockerfile
FROM ubuntu:22.04
ENTRYPOINT ["sleep"]
CMD ["5"]
```

* Если запустить контейнер без аргументов:

  ```bash
  docker run ubuntu-sleeper
  ```

  Выполнится `sleep 5`.

* Если запустить с аргументом:

  ```bash
  docker run ubuntu-sleeper 10
  ```

  Выполнится `sleep 10`.

---

## 6. Переопределение ENTRYPOINT

Если нужно изменить саму команду при запуске контейнера, используйте `--entrypoint`:

```bash
docker run --entrypoint supersleep ubuntu-sleeper 10
```

Теперь запустится `supersleep 10`.
