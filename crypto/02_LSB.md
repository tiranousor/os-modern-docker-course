# Лабораторная работа: Стеганография в изображениях (LSB)

### 1. Цель работы

* Спрятать текст в изображение и восстановить его обратно.
* Оценить незаметность изменений (по стандартным метрикам качества изображения).
* Исследовать обнаружимость стегосообщения простыми статистическими тестами.

---

### 2. Теория

* **Стеганография** — сокрытие самого факта передачи данных (в отличие от шифрования, где скрывается смысл).
* **Метод LSB (Least Significant Bit)** основан на замене младших битов цветовых компонент (R, G, B) на биты скрываемого сообщения.

Например,

```
Байт синего канала: 11010010  
Встраиваем бит "1" → 11010011
```
Изменение на ±1 неразличимо для глаза.

* **Payload (доля полезной нагрузки):** какая часть доступной емкости используется под сообщение.

  Емкость при 1 LSB на канал:

<img width="622" height="64" alt="image" src="https://github.com/user-attachments/assets/8b93c5a8-34a8-42a8-a0a1-1f8ca36746eb" />

* **Незаметность** оценивают по метрикам качества изображения (PSNR, SSIM).
* **Обнаружимость** проверяют статистическими тестами на распределения/структуры битов:

  * **χ²-тест (хи-квадрат):** сравнивает ожидаемое и фактическое распределение пар значений, чувствителен к «выравниванию» LSB.
  * **RS-анализ (Regular–Singular):** измеряет, как меняется регулярность групп пикселей при искусственном флиппе LSB; дисбаланс указывает на встраивание.

### 3. Что нужно сделать

#### 3.1. Утилита

1. **Разработать утилиту** (или модуль) для стеганографии методом LSB с командным интерфейсом.
2. **Вход:** изображение (PNG) и текст.
   **Выход:** изображение того же размера со спрятанным текстом и восстановленный из него текст.
3. Реализовать **встраивание** (замена младших битов по выбранному порядку обхода пикселей/каналов) и **извлечение** (в том же порядке). Способ обозначения конца сообщения — любой разумный (например, длина или маркер).
4. Провести **оценку незаметности** (метрики качества, визуальные сравнения/разность) и **проверку обнаружимости** (любой один базовый тест: χ² или RS).
5. Исследовать влияние **payload**: показать, как меняются качество и обнаружимость при нескольких уровнях загрузки.

**Проверка емкости:**

<img width="800" height="68" alt="image" src="https://github.com/user-attachments/assets/2a0c53b1-00e0-4747-9f58-765c75ddd316" />

Подумать, какое требование нужно для корректной работы.

---

#### 3.2. Анализ искажений (незаметность)

1. Рассчитать **PSNR**, **SSIM** между `cover` и `stego`.
2. Построить **карту разности** `|cover − stego|` (серым или тепловой картой).
3. Построить **гистограммы** каналов **до/после** (по одному примеру достаточно).

---

### 3. Базовый стегоанализ (выполнить один метод)

**Вариант 1. χ²-тест по LSB:**

* Для каждого канала собрать гистограмму значений 0…255.
* Рассмотреть пары 2k, 2k+1.
* Для каждой пары:
<img width="800" height="125" alt="image" src="https://github.com/user-attachments/assets/120a2ab4-f9b5-43f0-abbd-2e3323bda9c8" />

большие нагрузки → ниже p-value (проще детектировать).

**Вариант 2. RS-анализ :**

* Делить пиксели на группы фиксированного размера;
* Подсчитывать "регулярные"/"сингулярные" группы до/после инвертирования LSB;
* Разница частот указывает на наличие встроенного сообщения.

**Эксперимент:**
Для payload **0.1%, 0.5%, 1%, 5%**:

* сгенерируйте набор stego-изображений из ваших cover;
* посчитайте метрику детектора для cover и stego;
* постройте **ROC-кривую** (TPR/FPR) или посчитайте **AUC**.

**Как задать payload на практике:**
Пусть `capacity_bits` — доступная емкость. Тогда
<img width="800" height="128" alt="image" src="https://github.com/user-attachments/assets/9f754336-a49a-40e2-9240-ace586bd7cda" />

Округлите вниз до кратного 8, возьмите первые `message_bits/8` байт из исходного текста (или сгенерируйте).

---

### 5. Датасет

Использовать **минимум 4 изображения**:

1. `gradient.png` — плавный градиент,
2. `checkerboard.png` — цветная шахматная текстура,
3. `noise_texture.png` — шум,
4. **одно свое** (≥256×256, сохраненное как PNG).

---

### 6. Ограничения и допущения

* Разрешенные библиотеки: загрузка/сохранение изображений и метрики/графики (**Pillow / OpenCV / scikit-image / matplotlib** и аналоги).
* Алгоритмы LSB/детектора реализовать **самостоятельно**.
* Порядок обхода пикселей и каналов должен быть **одинаковым** для encode/decode и описан в отчете.

---

### 7. Что сдавать

1. Ссылку на репозиторий с готовым заданием.
