# Лабораторная: локальный приватный Docker Registry

## Цель
- Поднять локальный Docker Registry в контейнере.
- Собрать образ, запушить в локальный registry и спуллить обратно.
- Проверить, что образ реально хранится в registry.

## Требования
- Установлен Docker.
- `curl`

---

## 1) Поднимите локальный registry

Запустите контейнер registry на порту 5000, имя контейнера `registry`, образ `registry:2`.

Подсказка (как должна выглядеть логика команды):
- запуск в фоне
- проброс порта 5000:5000
- имя контейнера `registry`
- образ `registry:2`

Проверьте, что контейнер запущен (`docker ps`). Сделайте скрин.

---

## 2) Проверка registry по API

Проверьте, что registry отвечает и репозиториев пока нет:

```bash
curl http://localhost:5000/v2/_catalog
````

Ожидаемо:

```json
{"repositories":[]}
```

Скрин результата.

---

## 3) Подготовьте мини-проект

Создайте папку `web-demo-<ваш_логин>` и файлы:

* `index.html` — обязательно содержит:

  * строку `Hello Registry`
  * ваш логин/ФИО
  * версию `1.0`

* `Dockerfile`:

  * базовый образ `nginx:alpine`
  * копирование `index.html` в `/usr/share/nginx/html/index.html`

Скрин содержимого файлов.

---

## 4) Сборка образа 

Соберите образ с тегом `web-demo-<ваш_логин>:1.0`:

```bash
docker build -t web-demo-<ваш_логин>:1.0 .
```

Проверьте, что образ появился (`docker images`). Скрин.

---

## 5) Привязка образа к registry через tag

Перетегируйте образ так, чтобы он указывал на локальный registry:

```bash
docker tag web-demo-<ваш_логин>:1.0 localhost:5000/web-demo-<ваш_логин>:1.0
```

Проверьте, что теперь есть два имени/тега у одного и того же образа (`docker images`). Скрин.

---

## 6) Push в registry

Запушьте образ в registry:

```bash
docker push localhost:5000/web-demo-<ваш_логин>:1.0
```

Скрин вывода `push`.

---

## 7) Проверка, что образ реально в registry

Проверьте список репозиториев:

```bash
curl http://localhost:5000/v2/_catalog
```

Ожидаемо:

```json
{"repositories":["web-demo-<ваш_логин>"]}
```

Проверьте список тегов:

```bash
curl http://localhost:5000/v2/web-demo-<ваш_логин>/tags/list
```

Ожидаемо:

```json
{"name":"web-demo-<ваш_логин>","tags":["1.0"]}
```

Скрины обоих запросов.

---

## 8) Проверка pull

Задача: доказать, что pull реально скачивает из registry.

1. Удалите только тег `localhost:5000/...` (локальный `web-demo-<логин>:1.0` не удаляйте).
2. Выполните `docker pull localhost:5000/web-demo-<логин>:1.0`.

Скрин `pull`.

---

## 9) Проверка запуском контейнера

Запустите контейнер из образа `localhost:5000/web-demo-<логин>:1.0` с пробросом порта 8080:80.
Откройте в браузере `http://localhost:8080` и убедитесь, что отображается ваш HTML.
Сделайте запрос на страницу и приложите скрин результата.

---

## 10) Самостоятельная часть

### 10.1 Версия 2.0

* Измените `index.html`, добавьте строку `Version 2.0`
* Соберите образ с тегом `2.0`
* Запушьте `2.0` в registry
* Проверьте через API, что у репозитория есть теги `1.0` и `2.0` (скрин)

### 10.2 Второй запуск на другом порту

Запустите второй контейнер из версии `2.0` на другом порту (например 8081) и проверьте:

* `http://localhost:8080` показывает версию 1.0
* `http://localhost:8081` показывает версию 2.0
  Скрины браузера (и curl).
